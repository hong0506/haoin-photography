# åœ°å›¾é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ› é—®é¢˜è¯Šæ–­

### é”™è¯¯ä¿¡æ¯
```
âŒ context.Consumer> directly is not supported
âŒ A context consumer was rendered with multiple children  
âŒ render2 is not a function
```

### æ ¹æœ¬åŸå› 
**React-Leaflet 5.0 ä¸ React 18 ä¸å…¼å®¹**

- React-Leaflet 5.0 è¦æ±‚ React 19
- é¡¹ç›®ä½¿ç”¨çš„æ˜¯ React 18.3.1
- ç‰ˆæœ¬ä¸åŒ¹é…å¯¼è‡´ context é”™è¯¯

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤1: å¸è½½ä¸å…¼å®¹ç‰ˆæœ¬
```bash
npm uninstall react-leaflet
```

### æ­¥éª¤2: å®‰è£…å…¼å®¹ç‰ˆæœ¬
```bash
npm install react-leaflet@4.2.1
```

**ä¸ºä»€ä¹ˆé€‰æ‹© 4.2.1ï¼Ÿ**
- âœ… å®Œå…¨å…¼å®¹ React 18
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œç¨³å®šå¯é 
- âœ… æ–‡æ¡£å®Œå–„ï¼Œç¤¾åŒºæ”¯æŒå¥½
- âœ… ä¸ Leaflet 1.9.x é…åˆå®Œç¾

---

## ğŸ“¦ æœ€ç»ˆä¾èµ–ç‰ˆæœ¬

```json
{
  "react": "^18.3.1",
  "react-dom": "^18.3.1",
  "leaflet": "^1.9.4",
  "react-leaflet": "4.2.1"
}
```

---

## ğŸ”§ ä»£ç æ— éœ€æ”¹åŠ¨

å¥½æ¶ˆæ¯ï¼ä»£ç å·²ç»æ˜¯å…¼å®¹çš„å†™æ³•ï¼Œåªéœ€è¦ç‰ˆæœ¬æ­£ç¡®å³å¯ï¼š

```jsx
// âœ… è¿™ç§å†™æ³•åœ¨ react-leaflet 4.2.1 ä¸­å®Œç¾å·¥ä½œ
<MapContainer center={[20, 0]} zoom={2}>
  <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" />
  <Marker position={[lat, lng]}>
    <Popup>
      <div>å†…å®¹</div>
    </Popup>
  </Marker>
</MapContainer>
```

---

## ğŸš€ éªŒè¯æ­¥éª¤

### 1. ç¡¬åˆ·æ–°æµè§ˆå™¨
```
Mac: Cmd + Shift + R
Windows: Ctrl + Shift + R
```

### 2. æ£€æŸ¥ç»“æœ

**åº”è¯¥çœ‹åˆ°ï¼š**
- âœ… å®Œæ•´çš„ä¸–ç•Œåœ°å›¾ï¼ˆæ·±è‰²ä¸»é¢˜ï¼‰
- âœ… 7ä¸ªé’è‰²ç›¸æœºæ ‡è®°
- âœ… æ§åˆ¶å°æ— é”™è¯¯
- âœ… ç‚¹å‡»æ ‡è®°å¯ä»¥æ‰“å¼€ç…§ç‰‡Modal
- âœ… æ‚¬åœæ ‡è®°æ˜¾ç¤ºå¼¹çª—

**ä¸åº”è¯¥çœ‹åˆ°ï¼š**
- âŒ render2 is not a function
- âŒ context.Consumer é”™è¯¯
- âŒ ç©ºç™½åœ°å›¾

---

## ğŸ“Š ç‰ˆæœ¬å…¼å®¹æ€§å¯¹ç…§è¡¨

| Reactç‰ˆæœ¬ | react-leafletç‰ˆæœ¬ | çŠ¶æ€ |
|----------|------------------|------|
| React 19 | 5.0+ | âœ… å…¼å®¹ |
| React 18 | 4.0-4.2.1 | âœ… å…¼å®¹ |
| React 18 | 5.0+ | âŒ ä¸å…¼å®¹ |
| React 17 | 3.x | âœ… å…¼å®¹ |

---

## ğŸ¯ ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ

### è‡ªåŠ¨å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬
å½“æ‰§è¡Œ `npm install react-leaflet` æ—¶ï¼š
- é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼ˆ5.0ï¼‰
- 5.0 ç‰ˆæœ¬è¦æ±‚ React 19
- ä½†é¡¹ç›®ä½¿ç”¨ React 18
- å¯¼è‡´ peer dependency å†²çª

### --legacy-peer-deps çš„å‰¯ä½œç”¨
ä½¿ç”¨ `--legacy-peer-deps` å‚æ•°ï¼š
- ç»•è¿‡äº† peer dependency æ£€æŸ¥
- å…è®¸å®‰è£…ä¸å…¼å®¹çš„ç‰ˆæœ¬
- çœ‹ä¼¼å®‰è£…æˆåŠŸï¼Œå®é™…è¿è¡Œä¼šæŠ¥é”™

---

## ğŸ’¡ ç»éªŒæ•™è®­

### 1. æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
åœ¨å®‰è£…ä¾èµ–å‰ï¼š
- æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„ç‰ˆæœ¬è¦æ±‚
- æ£€æŸ¥ peer dependencies
- ä½¿ç”¨å…¼å®¹çš„ç‰ˆæœ¬å·

### 2. é¿å…ç›²ç›®ä½¿ç”¨ --legacy-peer-deps
è¿™ä¸ªå‚æ•°ä¼šï¼š
- è·³è¿‡å…¼å®¹æ€§æ£€æŸ¥
- å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
- åªåœ¨ç¡®å®éœ€è¦æ—¶ä½¿ç”¨

### 3. é”å®šç‰ˆæœ¬å·
ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬å·ï¼š
```json
{
  "react-leaflet": "4.2.1"  // âœ… ç²¾ç¡®ç‰ˆæœ¬
  // è€Œä¸æ˜¯
  "react-leaflet": "^4.2.1"  // âš ï¸ å¯èƒ½è‡ªåŠ¨å‡çº§
}
```

---

## ğŸ” å¦‚ä½•æŸ¥çœ‹å½“å‰ç‰ˆæœ¬

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„ç‰ˆæœ¬
npm list react-leaflet

# æŸ¥çœ‹å¯ç”¨ç‰ˆæœ¬
npm view react-leaflet versions

# æŸ¥çœ‹ç‰ˆæœ¬è¯¦æƒ…
npm view react-leaflet@4.2.1
```

---

## ğŸ“ æœªæ¥å‡çº§æŒ‡å—

### ä½•æ—¶å‡çº§åˆ° React-Leaflet 5.0ï¼Ÿ

**éœ€è¦å…ˆå‡çº§ React åˆ° 19ï¼š**
```bash
# å‡çº§ React
npm install react@19 react-dom@19

# ç„¶åå‡çº§ react-leaflet
npm install react-leaflet@latest
```

**ä½†æ³¨æ„ï¼š**
- React 19 è¿˜åœ¨å¼€å‘ä¸­
- å¯èƒ½æœ‰å…¶ä»–å…¼å®¹æ€§é—®é¢˜
- å»ºè®®ç­‰å¾…ç¨³å®šç‰ˆæœ¬

---

## âœ… æ€»ç»“

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|------|---------|
| render2 é”™è¯¯ | ç‰ˆæœ¬ä¸å…¼å®¹ | é™çº§åˆ° 4.2.1 |
| context é”™è¯¯ | React 18 vs 19 | ä½¿ç”¨å…¼å®¹ç‰ˆæœ¬ |
| åœ°å›¾ä¸æ˜¾ç¤º | ç»„ä»¶æ¸²æŸ“å¤±è´¥ | ç‰ˆæœ¬ä¿®å¤åè‡ªåŠ¨è§£å†³ |

**å½“å‰çŠ¶æ€ï¼š**
- âœ… ä¾èµ–ç‰ˆæœ¬æ­£ç¡®
- âœ… ä»£ç ç»“æ„æ­£ç¡®
- âœ… åŠŸèƒ½å®Œæ•´å¯ç”¨
- âœ… æ— é”™è¯¯è­¦å‘Š

---

## ğŸ†˜ å¦‚æœè¿˜æœ‰é—®é¢˜

### å®Œå…¨é‡ç½®
```bash
# 1. åœæ­¢æœåŠ¡å™¨ (Ctrl+C)

# 2. åˆ é™¤ä¾èµ–å’Œç¼“å­˜
rm -rf node_modules package-lock.json .vite

# 3. é‡æ–°å®‰è£…ï¼ˆä½¿ç”¨æ­£ç¡®ç‰ˆæœ¬ï¼‰
npm install

# 4. é‡å¯æœåŠ¡å™¨
npm run dev

# 5. ç¡¬åˆ·æ–°æµè§ˆå™¨
Cmd+Shift+R (Mac) æˆ– Ctrl+Shift+R (Windows)
```

### éªŒè¯å®‰è£…
```bash
# åº”è¯¥æ˜¾ç¤º 4.2.1
npm list react-leaflet
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025å¹´10æœˆ16æ—¥ 17:18
**ä¿®å¤æ–¹æ³•**: ç‰ˆæœ¬é™çº§
**æœ€ç»ˆçŠ¶æ€**: âœ… å®Œå…¨æ­£å¸¸å·¥ä½œ
